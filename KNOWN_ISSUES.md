# –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (Known Issues) v2.2.0

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ v2.2.0

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| JSON race conditions | SQLite transactions |
| Memory leak –≤ rate_limiter | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ |
| Webhook payments –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è | –î–æ–±–∞–≤–ª–µ–Ω webhook handler |
| –ù–µ—Ç graceful shutdown | Signal handlers |

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

### 1. –û—à–∏–±–∫–∞ 409 Conflict –∏ –∑–∞–¥–≤–æ–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö –±–æ—Ç –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –æ—à–∏–±–∫–æ–π `409 Conflict: terminated by other getUpdates request` –æ—Ç Telegram API.

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–≤–∞–∂–¥—ã
- –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `409 Conflict`
- –ë–æ—Ç –º–æ–∂–µ—Ç "–∑–∞–≤–∏—Å–∞—Ç—å" –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ó–∞–ø—É—â–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞ —Å –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º
2. –ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ –Ω–µ –±—ã–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω
3. Race condition –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback_query

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ø—É—â–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä
pkill -f "python.*bot.py"
sleep 5
./start.sh
```

---

### 2. Database Lock –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–∏ 50+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö SQLite –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è.

**Workaround:**
```python
# –£–≤–µ–ª–∏—á–∏—Ç—å timeout –≤ database.py
conn = sqlite3.connect(self.db_path, timeout=30.0)
```

**Permanent fix:** –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PostgreSQL –≤ v3.0

---

## üü° –°—Ä–µ–¥–Ω–∏–µ

### 3. Webhook –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ Render/Railway

**–û–ø–∏—Å–∞–Ω–∏–µ:**
Free tier –ø–ª–∞—Ç—Ñ–æ—Ä–º –∑–∞—Å—ã–ø–∞–µ—Ç ‚Üí webhook –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤–æ–≤—Ä–µ–º—è.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Heroku/VPS
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ ping health check –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —á–µ—Ä–µ–∑ UptimeRobot

---

### 4. Rate limiter –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ

**–û–ø–∏—Å–∞–Ω–∏–µ:**
In-memory —Å–ª–æ–≤–∞—Ä—å —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.

**–°—Ç–∞—Ç—É—Å:**
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –õ–∏–º–∏—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.

**Future:** –•—Ä–∞–Ω–∏—Ç—å –≤ Redis (v2.3.0)

---

### 5. –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í–∏–¥–µ–æ —Ä–∞–∑–º–µ—Ä–æ–º –±–æ–ª–µ–µ 50MB –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –æ—á–µ–Ω—å –¥–æ–ª–≥–æ (5+ –º–∏–Ω—É—Ç).

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FFmpeg –∏ Telegram API. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–æ 20MB.

---

## üü¢ –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ

### 6. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø–æ–ª–Ω–∞—è

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

**–°—Ç–∞—Ç—É—Å:**
–í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è PR —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏.

---

## Performance Tips

### Database vacuum

–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ë–î:
```bash
sqlite3 data/bot.db "VACUUM;"
```

### Log rotation

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤:
```
# /etc/logrotate.d/docgen-bot
/root/docgen-bot/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    notifempty
    missingok
}
```

### Memory monitoring

–ï—Å–ª–∏ –±–æ—Ç –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç > 500MB RAM:
```bash
./restart.sh
```

---

## –ö–∞–∫ —Å–æ–æ–±—â–∏—Ç—å –æ –Ω–æ–≤–æ–π –ø—Ä–æ–±–ª–µ–º–µ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –æ–ø–∏—Å–∞–Ω–∞ –≤—ã—à–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `cat logs/bot_$(date +%Y%m%d).log`
3. –°–æ–∑–¥–∞–π—Ç–µ Issue –Ω–∞ GitHub —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
   - –®–∞–≥–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   - –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
   - –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
   - –õ–æ–≥–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –í–µ—Ä—Å–∏—è Python –∏ –û–°

---

## –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç–∏–Ω–≥

Pull Requests –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è!

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É: `git checkout -b fix/issue-name`
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ
5. –°–æ–∑–¥–∞–π—Ç–µ PR —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
